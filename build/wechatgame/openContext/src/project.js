require=function i(r,c,s){function l(t,e){if(!c[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var a=c[t]={exports:{}};r[t][0].call(a.exports,function(e){return l(r[t][1][e]||e)},a,a.exports,i,r,c,s)}return c[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({RankItem:[function(e,t,n){"use strict";cc._RF.push(t,"402fblUWhtJv7HK5U/AgIfB","RankItem"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,i=o.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.user_Name=null,e.user_Score=null,e.user_Icon=null,e.rank_num=null,e.rank_1=null,e.rank_2=null,e.rank_3=null,e}return __extends(e,t),e.prototype.init=function(e,t){var n=t.avatarUrl,o=t.nickname,a=0!=t.KVDataList.length?t.KVDataList[0].value:0;this.rank_num.node.active=!1,0==e?(this.rank_1.active=!0,this.rank_2.active=!1,this.rank_3.active=!1):1==e?(this.rank_1.active=!1,this.rank_2.active=!0,this.rank_3.active=!1):2==e?(this.rank_1.active=!1,this.rank_2.active=!1,this.rank_3.active=!0):(this.rank_1.active=!1,this.rank_2.active=!1,this.rank_3.active=!1,this.rank_num.node.active=!0),this.rank_num.string=(e+1).toString(),this.user_Name.string=o,this.user_Score.string=a.toString(),this.createImage(n)},e.prototype.createImage=function(e){var t=this;try{var n=wx.createImage();n.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),t.user_Icon.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.user_Icon.node.active=!1}},n.src=e}catch(e){cc.log(e),this.user_Icon.node.active=!1}},__decorate([i(cc.Label)],e.prototype,"user_Name",void 0),__decorate([i(cc.Label)],e.prototype,"user_Score",void 0),__decorate([i(cc.Sprite)],e.prototype,"user_Icon",void 0),__decorate([i(cc.Label)],e.prototype,"rank_num",void 0),__decorate([i(cc.Node)],e.prototype,"rank_1",void 0),__decorate([i(cc.Node)],e.prototype,"rank_2",void 0),__decorate([i(cc.Node)],e.prototype,"rank_3",void 0),e=__decorate([a],e)}(cc.Component);n.default=r,cc._RF.pop()},{}],Rank:[function(e,t,n){"use strict";cc._RF.push(t,"e1b90/rohdEk4SdmmEZANaD","Rank"),Object.defineProperty(n,"__esModule",{value:!0});var r=e("./RankItem"),o=cc._decorator,a=o.ccclass,i=o.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scrollViewContent=null,e.rank_item=null,e.loadingLabel=null,e}return __extends(e,t),e.prototype.start=function(){this.init()},e.prototype.test=function(){for(var e=0;e<100;e++){var t={avatarUrl:"http://112.74.174.202:8080/success.png",nickname:"校董"+e,KVDataList:[{value:e}]},n=cc.instantiate(this.rank_item);n.getComponent(r.default).init(e,t),this.scrollViewContent.addChild(n)}},e.prototype.init=function(){var t=this;window.wx.onMessage(function(e){cc.log("接收主域发来消息：",e),0==e.messageType||(1==e.messageType?t.fetchFriendData(e.MAIN_MENU_NUM):3==e.messageType?t.submitScore(e.MAIN_MENU_NUM,e.score):5==e.messageType&&t.fetchGroupFriendData(e.MAIN_MENU_NUM,e.shareTicket))})},e.prototype.initView=function(){this.scrollViewContent.removeAllChildren(),this.loadingLabel.getComponent(cc.Label).string="玩命加载中...",this.loadingLabel.active=!0},e.prototype.submitScore=function(t,n){window.wx.getUserCloudStorage({keyList:[t],success:function(e){console.log("getUserCloudStorage","success",e),0!=e.KVDataList.length&&e.KVDataList[0].value>n||window.wx.setUserCloudStorage({KVDataList:[{key:t,value:""+n}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},e.prototype.fetchFriendData=function(t){var i=this;this.initView(),cc.log("selfOpenId----\x3e>>",["selfOpenId"]),wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){i.loadingLabel.active=!1,console.log("success",e.data);e.data[0];wx.getFriendCloudStorage({keyList:[t],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var n=0;n<t.length;n++){var o=t[n],a=cc.instantiate(i.rank_item);a.getComponent(r.default).init(n,o),i.scrollViewContent.addChild(a)}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),i.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){i.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},e.prototype.fetchGroupFriendData=function(t,n){var i=this;this.initView(),wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("success",e.data);e.data[0];wx.getGroupCloudStorage({shareTicket:n,keyList:[t],success:function(e){console.log("wx.getGroupCloudStorage success",e),i.loadingLabel.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var n=0;n<t.length;n++){var o=t[n],a=cc.instantiate(i.rank_item);a.getComponent("RankItem").init(n,o),i.scrollViewContent.addChild(a)}t.length<=8&&(i.scrollViewContent.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE)},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),i.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){i.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},__decorate([i(cc.Node)],e.prototype,"scrollViewContent",void 0),__decorate([i(cc.Prefab)],e.prototype,"rank_item",void 0),__decorate([i(cc.Node)],e.prototype,"loadingLabel",void 0),e=__decorate([a],e)}(cc.Component);n.default=c,cc._RF.pop()},{"./RankItem":"RankItem"}]},{},["Rank","RankItem"]);