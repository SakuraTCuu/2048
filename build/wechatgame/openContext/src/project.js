__require=function e(t,n,o){function a(r,c){if(!n[r]){if(!t[r]){var s=r.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!c&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+r+"'")}}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){return a(t[r][1][e]||e)},u,u.exports,e,t,n,o)}return n[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<o.length;r++)a(o[r]);return a}({RankItem:[function(e,t,n){"use strict";cc._RF.push(t,"402fblUWhtJv7HK5U/AgIfB","RankItem"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,i=o.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.user_Name=null,t.user_Score=null,t.user_Icon=null,t.rank_num=null,t.rank_1=null,t.rank_2=null,t.rank_3=null,t}return __extends(t,e),t.prototype.init=function(e,t){var n=t.avatarUrl,o=t.nickname,a=0!=t.KVDataList.length?t.KVDataList[0].value:0;this.rank_num.node.active=!1,0==e?(this.rank_1.active=!0,this.rank_2.active=!1,this.rank_3.active=!1):1==e?(this.rank_1.active=!1,this.rank_2.active=!0,this.rank_3.active=!1):2==e?(this.rank_1.active=!1,this.rank_2.active=!1,this.rank_3.active=!0):(this.rank_1.active=!1,this.rank_2.active=!1,this.rank_3.active=!1,this.rank_num.node.active=!0),this.rank_num.string=(e+1).toString(),this.user_Name.string=o,this.user_Score.string=a.toString(),this.createImage(n)},t.prototype.createImage=function(e){var t=this;try{var n=wx.createImage();n.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),t.user_Icon.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.user_Icon.node.active=!1}},n.src=e}catch(e){cc.log(e),this.user_Icon.node.active=!1}},__decorate([i(cc.Label)],t.prototype,"user_Name",void 0),__decorate([i(cc.Label)],t.prototype,"user_Score",void 0),__decorate([i(cc.Sprite)],t.prototype,"user_Icon",void 0),__decorate([i(cc.Label)],t.prototype,"rank_num",void 0),__decorate([i(cc.Node)],t.prototype,"rank_1",void 0),__decorate([i(cc.Node)],t.prototype,"rank_2",void 0),__decorate([i(cc.Node)],t.prototype,"rank_3",void 0),t=__decorate([a],t)}(cc.Component);n.default=r,cc._RF.pop()},{}],Rank:[function(e,t,n){"use strict";cc._RF.push(t,"e1b90/rohdEk4SdmmEZANaD","Rank"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./RankItem"),a=cc._decorator,i=a.ccclass,r=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scrollViewContent=null,t.rank_item=null,t.loadingLabel=null,t}return __extends(t,e),t.prototype.start=function(){this.init()},t.prototype.test=function(){for(var e=0;e<100;e++){var t={avatarUrl:"http://112.74.174.202:8080/success.png",nickname:"\u6821\u8463"+e,KVDataList:[{value:e}]},n=cc.instantiate(this.rank_item);n.getComponent(o.default).init(e,t),this.scrollViewContent.addChild(n)}},t.prototype.init=function(){var e=this;window.wx.onMessage(function(t){cc.log("\u63a5\u6536\u4e3b\u57df\u53d1\u6765\u6d88\u606f\uff1a",t),0==t.messageType||(1==t.messageType?e.fetchFriendData(t.MAIN_MENU_NUM):3==t.messageType?e.submitScore(t.MAIN_MENU_NUM,t.score):5==t.messageType&&e.fetchGroupFriendData(t.MAIN_MENU_NUM,t.shareTicket))})},t.prototype.initView=function(){this.scrollViewContent.removeAllChildren(),this.loadingLabel.getComponent(cc.Label).string="\u73a9\u547d\u52a0\u8f7d\u4e2d...",this.loadingLabel.active=!0},t.prototype.submitScore=function(e,t){window.wx.getUserCloudStorage({keyList:[e],success:function(n){console.log("getUserCloudStorage","success",n),0!=n.KVDataList.length&&n.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:e,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},t.prototype.fetchFriendData=function(e){var t=this;this.initView(),cc.log("selfOpenId----\x3e>>",["selfOpenId"]),wx.getUserInfo({openIdList:["selfOpenId"],success:function(n){t.loadingLabel.active=!1,console.log("success",n.data);n.data[0];wx.getFriendCloudStorage({keyList:[e],success:function(e){console.log("wx.getFriendCloudStorage success",e);var n=e.data;n.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var a=0;a<n.length;a++){var i=n[a],r=cc.instantiate(t.rank_item);r.getComponent(o.default).init(a,i),t.scrollViewContent.addChild(r)}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),t.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},fail:function(e){t.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},t.prototype.fetchGroupFriendData=function(e,t){var n=this;this.initView(),wx.getUserInfo({openIdList:["selfOpenId"],success:function(o){console.log("success",o.data);o.data[0];wx.getGroupCloudStorage({shareTicket:t,keyList:[e],success:function(e){console.log("wx.getGroupCloudStorage success",e),n.loadingLabel.active=!1;var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value});for(var o=0;o<t.length;o++){var a=t[o],i=cc.instantiate(n.rank_item);i.getComponent("RankItem").init(o,a),n.scrollViewContent.addChild(i)}t.length<=8&&(n.scrollViewContent.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE)},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),n.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},fail:function(e){n.loadingLabel.getComponent(cc.Label).string="\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4b\u7f51\u7edc\uff0c\u8c22\u8c22\u3002"}})},__decorate([r(cc.Node)],t.prototype,"scrollViewContent",void 0),__decorate([r(cc.Prefab)],t.prototype,"rank_item",void 0),__decorate([r(cc.Node)],t.prototype,"loadingLabel",void 0),t=__decorate([i],t)}(cc.Component);n.default=c,cc._RF.pop()},{"./RankItem":"RankItem"}]},{},["Rank","RankItem"]);